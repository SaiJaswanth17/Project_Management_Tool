'use strict';

const modifiedPaths = require('./modifiedPaths');

module.exports = function updatedPathsByArrayFilter(update) {
<<<<<<< HEAD
  if (update == null) {
    return {};
  }
=======
>>>>>>> b27af961a96dd61074668580d2744d16862a539a
  const updatedPaths = modifiedPaths(update);

  return Object.keys(updatedPaths).reduce((cur, path) => {
    const matches = path.match(/\$\[[^\]]+\]/g);
    if (matches == null) {
      return cur;
    }
    for (const match of matches) {
      const firstMatch = path.indexOf(match);
      if (firstMatch !== path.lastIndexOf(match)) {
        throw new Error(`Path '${path}' contains the same array filter multiple times`);
      }
      cur[match.substring(2, match.length - 1)] = path.
<<<<<<< HEAD
        substring(0, firstMatch - 1).
=======
        substr(0, firstMatch - 1).
>>>>>>> b27af961a96dd61074668580d2744d16862a539a
        replace(/\$\[[^\]]+\]/g, '0');
    }
    return cur;
  }, {});
<<<<<<< HEAD
};
=======
};
>>>>>>> b27af961a96dd61074668580d2744d16862a539a
